/*!
Copyright (c) Nationwide Building Society 2010. All rights reserved.
*/
(function($){twistiePublic=$.fn.twistie=function(options){var settings={areaName:"",viewName:"",url:"/Twistie/TwistieState",manageState:!0,revealContainer:""},twistieStates,getTwistieStates;return options=$.extend(settings,options||{}),twistieStates=[],getTwistieStates=function(){options.manageState&&twistieStates.length>0&&$.get(options.url,{areaName:options.areaName,viewName:options.viewName,twistieIds:twistieStates.toString()},function(data){$.each(data,function(index,value){$("#"+value).trigger("click.twistieStateManagement",["noAjax"])})})},this.each(function(){var $twistieLink=$(this),$revealContainer,srTextSymbol,srTextSpan;options.revealContainer.length>0?$revealContainer=$("#"+options.revealContainer):($revealContainer=$twistieLink.nextAll("div.expanded-info-container:first"),$revealContainer.length==0&&($revealContainer=$twistieLink.parent().nextAll("div.expanded-info-container:first")));twistieStates.push($twistieLink.attr("id"));srTextSymbol=$twistieLink.find("span.symbol");srTextSpan=$twistieLink.find("span.srText").not(".twistie-ignore");$twistieLink.bind("click.twistieStateManagement",function(e,noAjax){if(e.preventDefault(),$twistieLink.hasClass("expanded")?($revealContainer.fadeOut(100,function(){$(window).trigger("resize")}),$twistieLink.removeClass("expanded"),srTextSymbol.text("+"),srTextSpan.text("Activate link to reveal additional information"),$(window).trigger("resize")):(noAjax===undefined?$revealContainer.fadeIn(300,function(){$(window).trigger("resize")}):$revealContainer.show(),$twistieLink.addClass("expanded"),srTextSymbol.text("-"),srTextSpan.text("Activate link to hide additional information"),$(window).trigger("resize")),$twistieLink[0].title&&$twistieLink[0].rel){var newTitle=$twistieLink[0].title,Twistie=$twistieLink;Twistie[0].title=Twistie[0].rel;Twistie[0].rel=newTitle;srTextSpan.text($twistieLink[0].title)}options.manageState&&noAjax===undefined&&$.ajax({type:"POST",url:options.url,data:{areaName:options.areaName,twistieId:$twistieLink.attr("id"),viewName:options.viewName,state:$twistieLink.hasClass("expanded")}})});$twistieLink[0].title&&$twistieLink[0].rel?srTextSpan.text($twistieLink[0].title):$twistieLink.hasClass("expanded")?srTextSpan.text("Activate link to hide additional information"):srTextSpan.text("Activate link to reveal additional information")}),getTwistieStates(),this}})(jQuery)